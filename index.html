<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­çº§æ‹å–ä¼šç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 450px;
            grid-template-rows: 80px 1fr 100px;
            grid-template-areas: 
                "header header"
                "main sidebar"
                "footer footer";
            height: 100vh;
            gap: 15px;
            padding: 15px;
        }

        .header {
            grid-area: header;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 36px;
            color: #333;
            font-weight: bold;
        }

        .main-area {
            grid-area: main;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .sidebar {
            grid-area: sidebar;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .footer {
            grid-area: footer;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }

        .item-management {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .item-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .item-card {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .item-card:hover {
            border-color: #667eea;
            background: #e8eaf6;
        }

        .item-card.active {
            border-color: #27ae60;
            background: #e8f5e9;
            border-width: 3px;
        }

        .item-card-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-card-image {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid #ddd;
        }

        .item-card-details {
            flex: 1;
        }

        .item-card-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .item-card-price {
            color: #e74c3c;
            font-size: 14px;
        }

        .item-card-actions {
            display: flex;
            gap: 5px;
        }

        .text-button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .text-button.edit {
            background: #3498db;
            color: white;
        }

        .text-button.delete {
            background: #e74c3c;
            color: white;
        }

        .text-button:hover {
            transform: scale(1.05);
        }

        .header-button {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .header-button:hover {
            transform: scale(1.05);
        }

        .item-display {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-state {
            text-align: center;
            color: #999;
            padding: 40px;
        }

        .empty-state-text {
            font-size: 24px;
            margin-bottom: 30px;
        }

        .add-item-button {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .add-item-button:hover {
            transform: scale(1.05);
        }

        .item-image {
            width: 300px;
            height: 300px;
            border-radius: 15px;
            object-fit: cover;
            margin-bottom: 20px;
            border: 3px solid #f0f0f0;
            display: none; /* é»˜è®¤éšè— */
        }

        .item-image.visible {
            display: block; /* æœ‰å›¾ç‰‡æ—¶æ˜¾ç¤º */
        }

        .item-info h2 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .item-description {
            font-size: 18px;
            color: #666;
            text-align: center;
            max-width: 500px;
            margin-bottom: 20px;
        }

        .current-price {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .price-label {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .price-amount {
            font-size: 48px;
            font-weight: bold;
        }

        .bid-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .bid-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            min-width: 120px;
        }

        .bid-button:hover {
            transform: scale(1.05);
        }

        .bid-button:active {
            transform: scale(0.95);
        }

        .bid-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .bid-input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 20px;
            width: 150px;
            text-align: center;
        }

        .bid-confirm {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-section h3 {
            font-size: 20px;
            color: #333;
            margin-bottom: 10px;
        }

        .bid-history {
            flex: 1;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            min-height: 150px;
        }

        .bid-record {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .bidder-name {
            font-weight: bold;
            font-size: 16px;
        }

        .bid-amount {
            font-size: 18px;
            color: #e74c3c;
            font-weight: bold;
        }

        .bid-time {
            font-size: 12px;
            color: #999;
        }

        .participant-management {
            max-height: 150px;
            overflow-y: auto;
        }

        .participant-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .participant-input {
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .add-participant-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .participant-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .participant {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .remove-participant {
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }

        .control-button {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            flex: 1;
            max-width: 200px;
        }

        .control-button:hover {
            transform: scale(1.05);
        }

        .control-button.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .control-button.success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }

        .control-button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .auction-status {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 0 20px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .form-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .form-button.primary {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }

        .form-button.secondary {
            background: #bdc3c7;
            color: #333;
        }

        .winner-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .winner-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .winner-text {
            font-size: 36px;
            color: #e74c3c;
            margin-bottom: 20px;
        }

        .winner-info {
            font-size: 24px;
            color: #333;
        }

        /* å›¾ç‰‡ä¸Šä¼ ç›¸å…³æ ·å¼ */
        .image-upload-section {
            margin-bottom: 15px;
        }

        .image-upload-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .upload-tab {
            flex: 1;
            padding: 8px;
            border: 2px solid #ddd;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .upload-tab.active {
            border-color: #27ae60;
            background: #e8f5e9;
            color: #27ae60;
        }

        .upload-content {
            display: none;
        }

        .upload-content.active {
            display: block;
        }

        .file-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f8f9fa;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background: #e8eaf6;
        }

        .file-upload-area.dragover {
            border-color: #27ae60;
            background: #e8f5e9;
        }

        .file-upload-input {
            display: none;
        }

        .file-upload-text {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .file-upload-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .image-preview {
            margin-top: 10px;
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            border: 2px solid #ddd;
            display: none;
        }

        .image-preview.visible {
            display: block;
        }

        .remove-image-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 80px 1fr 400px 100px;
                grid-template-areas: 
                    "header"
                    "main"
                    "sidebar"
                    "footer";
            }
            
            .sidebar {
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ç­çº§æ‹å–ä¼šç³»ç»Ÿ</h1>
            <button class="header-button" onclick="showAddItemModal()">æ·»åŠ ç‰©å“</button>
        </div>

        <div class="main-area">
            <div class="item-display" id="itemDisplay">
                <div class="empty-state">
                    <div class="empty-state-text">æš‚æ— æ‹å–ç‰©å“</div>
                    <button class="add-item-button" onclick="showAddItemModal()">æ·»åŠ ç¬¬ä¸€ä¸ªæ‹å–ç‰©å“</button>
                </div>
            </div>

            <div id="auctionInterface" style="display: none; width: 100%;">
                <div class="item-display">
                    <img class="item-image" id="itemImage" alt="ç‰©å“å›¾ç‰‡">
                    <div class="item-info">
                        <h2 id="itemName">ç‰©å“åç§°</h2>
                        <p class="item-description" id="itemDescription">ç‰©å“æè¿°</p>
                        <div class="current-price">
                            <div class="price-label">å½“å‰ä»·æ ¼</div>
                            <div class="price-amount" id="currentPrice">Â¥0</div>
                        </div>
                        <div class="bid-controls">
                            <button class="bid-button" onclick="quickBid(10)">+Â¥10</button>
                            <button class="bid-button" onclick="quickBid(50)">+Â¥50</button>
                            <button class="bid-button" onclick="quickBid(100)">+Â¥100</button>
                            <div class="bid-input-group">
                                <input type="number" class="bid-input" id="customBid" placeholder="è‡ªå®šä¹‰">
                                <button class="bid-confirm" onclick="customBid()">å‡ºä»·</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="item-management">
                <h3>ç‰©å“ç®¡ç†</h3>
                <div class="item-list" id="itemList">
                    <div class="empty-state" style="padding: 20px; font-size: 14px;">æš‚æ— ç‰©å“ï¼Œè¯·æ·»åŠ æ‹å–ç‰©å“</div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>å‡ºä»·è®°å½•</h3>
                <div class="bid-history" id="bidHistory">
                    <div class="empty-state">æš‚æ— å‡ºä»·è®°å½•</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3>ç«æ‹è€…ç®¡ç†</h3>
                <div class="participant-management">
                    <div class="participant-input-group">
                        <input type="text" class="participant-input" id="participantName" placeholder="è¾“å…¥ç«æ‹è€…å§“å">
                        <button class="add-participant-btn" onclick="addParticipant()">æ·»åŠ </button>
                    </div>
                    <div class="participant-list" id="participantList">
                        <div style="color: #999; font-size: 14px;">æš‚æ— ç«æ‹è€…</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="auction-status" id="auctionStatus">ç­‰å¾…å¼€å§‹</div>
            <button class="control-button" onclick="startAuction()" id="startButton" disabled>å¼€å§‹æ‹å–</button>
            <button class="control-button success" onclick="sold()" id="soldButton" disabled>æˆäº¤</button>
            <button class="control-button danger" onclick="unsold()" id="unsoldButton" disabled>æµæ‹</button>
            <button class="control-button" onclick="nextItem()" id="nextButton" disabled>ä¸‹ä¸€ä¸ª</button>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘ç‰©å“æ¨¡æ€æ¡† -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">æ·»åŠ æ‹å–ç‰©å“</div>
            <form id="itemForm">
                <div class="form-group">
                    <label>ç‰©å“åç§° *</label>
                    <input type="text" id="itemNameInput" placeholder="è¾“å…¥ç‰©å“åç§°" required>
                </div>
                <div class="form-group">
                    <label>ç‰©å“æè¿°</label>
                    <textarea id="itemDescInput" placeholder="è¾“å…¥ç‰©å“æè¿°ï¼ˆå¯é€‰ï¼‰"></textarea>
                </div>
                <div class="form-group">
                    <label>èµ·æ‹ä»·æ ¼ *</label>
                    <input type="number" id="itemPriceInput" placeholder="è¾“å…¥èµ·æ‹ä»·æ ¼" min="1" required>
                </div>
                
                <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
                <div class="form-group">
                    <label>ç‰©å“å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</label>
                    <div class="image-upload-section">
                        <div class="image-upload-tabs">
                            <div class="upload-tab active" onclick="switchUploadTab('url')">å›¾ç‰‡é“¾æ¥</div>
                            <div class="upload-tab" onclick="switchUploadTab('file')">æœ¬åœ°ä¸Šä¼ </div>
                        </div>
                        
                        <div id="urlUpload" class="upload-content active">
                            <input type="url" id="itemImageInput" placeholder="è¾“å…¥å›¾ç‰‡é“¾æ¥åœ°å€ï¼Œå¦‚ï¼šhttps://example.com/image.jpg">
                        </div>
                        
                        <div id="fileUpload" class="upload-content">
                            <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('fileInput').click()">
                                <div class="file-upload-text">ğŸ“· ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ </div>
                                <button type="button" class="file-upload-button">é€‰æ‹©å›¾ç‰‡</button>
                                <input type="file" id="fileInput" class="file-upload-input" accept="image/*">
                            </div>
                            <img id="imagePreview" class="image-preview">
                            <button type="button" id="removeImageBtn" class="remove-image-btn" style="display: none;" onclick="removeLocalImage()">ç§»é™¤å›¾ç‰‡</button>
                        </div>
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="form-button secondary" onclick="closeItemModal()">å–æ¶ˆ</button>
                    <button type="submit" class="form-button primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- é€‰æ‹©ç«æ‹è€…æ¨¡æ€æ¡† -->
    <div class="modal" id="bidderModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">é€‰æ‹©ç«æ‹è€…</div>
            <div id="bidderList" style="max-height: 300px; overflow-y: auto;">
                <!-- åŠ¨æ€ç”Ÿæˆç«æ‹è€…åˆ—è¡¨ -->
            </div>
            <div class="form-buttons">
                <button class="form-button secondary" onclick="closeBidderModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- æˆäº¤åŠ¨ç”» -->
    <div class="winner-animation" id="winnerAnimation">
        <div class="winner-content">
            <div class="winner-text">æ‹å–æˆäº¤ï¼</div>
            <div class="winner-info" id="winnerInfo"></div>
            <button class="control-button" onclick="closeWinner()" style="margin-top: 20px;">ç¡®å®š</button>
        </div>
    </div>

    <script>
        // æ‹å–ç³»ç»Ÿæ ¸å¿ƒæ•°æ®
        let auctionState = {
            currentItem: null,
            currentPrice: 0,
            isActive: false,
            bidHistory: [],
            auctionItems: [],
            currentItemIndex: 0,
            participants: [],
            currentBidder: null,
            editingItemIndex: -1,
            pendingBid: null,
            localImageData: null // å­˜å‚¨æœ¬åœ°å›¾ç‰‡çš„Base64æ•°æ®
        };

        // åˆå§‹åŒ–
        function init() {
            updateItemList();
            updateParticipantList();
            updateControlButtons();
            setupFileUpload();
        }

        // åˆ‡æ¢ä¸Šä¼ æ ‡ç­¾
        function switchUploadTab(tab) {
            document.querySelectorAll('.upload-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.upload-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'url') {
                document.querySelectorAll('.upload-tab')[0].classList.add('active');
                document.getElementById('urlUpload').classList.add('active');
            } else {
                document.querySelectorAll('.upload-tab')[1].classList.add('active');
                document.getElementById('fileUpload').classList.add('active');
            }
        }

        // è®¾ç½®æ–‡ä»¶ä¸Šä¼ 
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('fileUploadArea');
            
            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            fileInput.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    handleFileSelect(e.target.files[0]);
                }
            });
            
            // æ‹–æ‹½ä¸Šä¼ 
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFileSelect(e.dataTransfer.files[0]);
                }
            });
        }

        // å¤„ç†æ–‡ä»¶é€‰æ‹©ï¼ˆæ— å¤§å°é™åˆ¶ï¼‰
        function handleFileSelect(file) {
            // åªæ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
            if (!file.type.startsWith('image/')) {
                alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                auctionState.localImageData = e.target.result;
                displayImagePreview(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
        function displayImagePreview(imageData) {
            const preview = document.getElementById('imagePreview');
            preview.src = imageData;
            preview.classList.add('visible');
            document.getElementById('removeImageBtn').style.display = 'inline-block';
        }

        // ç§»é™¤æœ¬åœ°å›¾ç‰‡
        function removeLocalImage() {
            auctionState.localImageData = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('imagePreview').classList.remove('visible');
            document.getElementById('removeImageBtn').style.display = 'none';
        }

        // æ˜¾ç¤ºæ·»åŠ ç‰©å“æ¨¡æ€æ¡†
        function showAddItemModal() {
            document.getElementById('modalTitle').textContent = 'æ·»åŠ æ‹å–ç‰©å“';
            document.getElementById('itemForm').reset();
            auctionState.editingItemIndex = -1;
            auctionState.localImageData = null;
            removeLocalImage();
            switchUploadTab('url');
            document.getElementById('itemModal').style.display = 'flex';
        }

        // æ˜¾ç¤ºç¼–è¾‘ç‰©å“æ¨¡æ€æ¡†
        function showEditItemModal(index) {
            const item = auctionState.auctionItems[index];
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘æ‹å–ç‰©å“';
            document.getElementById('itemNameInput').value = item.name;
            document.getElementById('itemDescInput').value = item.description;
            document.getElementById('itemPriceInput').value = item.startPrice;
            
            // å¤„ç†å›¾ç‰‡
            auctionState.localImageData = null;
            removeLocalImage();
            
            if (item.imageUrl) {
                if (item.imageUrl.startsWith('data:')) {
                    // æœ¬åœ°å›¾ç‰‡
                    switchUploadTab('file');
                    auctionState.localImageData = item.imageUrl;
                    displayImagePreview(item.imageUrl);
                } else {
                    // ç½‘ç»œå›¾ç‰‡
                    switchUploadTab('url');
                    document.getElementById('itemImageInput').value = item.imageUrl;
                }
            } else {
                switchUploadTab('url');
            }
            
            auctionState.editingItemIndex = index;
            document.getElementById('itemModal').style.display = 'flex';
        }

        // å…³é—­ç‰©å“æ¨¡æ€æ¡†
        function closeItemModal() {
            document.getElementById('itemModal').style.display = 'none';
            document.getElementById('itemForm').reset();
            auctionState.editingItemIndex = -1;
            auctionState.localImageData = null;
            removeLocalImage();
        }

        // å¤„ç†ç‰©å“è¡¨å•æäº¤
        document.getElementById('itemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const item = {
                id: Date.now(),
                name: document.getElementById('itemNameInput').value,
                description: document.getElementById('itemDescInput').value || 'æš‚æ— æè¿°',
                startPrice: parseInt(document.getElementById('itemPriceInput').value),
                imageUrl: null
            };

            // å¤„ç†å›¾ç‰‡
            const activeTab = document.querySelector('.upload-tab.active').textContent;
            if (activeTab === 'å›¾ç‰‡é“¾æ¥') {
                const url = document.getElementById('itemImageInput').value.trim();
                if (url) {
                    item.imageUrl = url;
                }
            } else if (activeTab === 'æœ¬åœ°ä¸Šä¼ ' && auctionState.localImageData) {
                item.imageUrl = auctionState.localImageData;
            }

            if (auctionState.editingItemIndex >= 0) {
                auctionState.auctionItems[auctionState.editingItemIndex] = item;
            } else {
                auctionState.auctionItems.push(item);
            }

            closeItemModal();
            updateItemList();
            
            if (!auctionState.currentItem) {
                loadNextItem();
            }
        });

        // åˆ é™¤ç‰©å“
        function deleteItem(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç‰©å“å—ï¼Ÿ')) {
                auctionState.auctionItems.splice(index, 1);
                
                if (auctionState.currentItemIndex === index) {
                    auctionState.currentItem = null;
                    auctionState.isActive = false;
                    showEmptyState();
                } else if (auctionState.currentItemIndex > index) {
                    auctionState.currentItemIndex--;
                }
                
                updateItemList();
                updateControlButtons();
            }
        }

        // åŠ è½½ç‰©å“
        function loadItem(index) {
            if (index >= auctionState.auctionItems.length) return;
            
            auctionState.currentItemIndex = index;
            auctionState.currentItem = auctionState.auctionItems[index];
            auctionState.currentPrice = auctionState.currentItem.startPrice;
            auctionState.bidHistory = [];
            auctionState.isActive = false;
            auctionState.currentBidder = null;
            
            showAuctionInterface();
            updateDisplay();
            updateControlButtons();
            updateItemList();
        }

        // åŠ è½½ä¸‹ä¸€ä¸ªç‰©å“
        function loadNextItem() {
            if (auctionState.auctionItems.length === 0) {
                showEmptyState();
                return;
            }

            if (auctionState.currentItemIndex >= auctionState.auctionItems.length) {
                alert('æ‰€æœ‰ç‰©å“å·²æ‹å–å®Œæˆï¼');
                return;
            }

            loadItem(auctionState.currentItemIndex);
        }

        // æ˜¾ç¤ºç©ºçŠ¶æ€
        function showEmptyState() {
            document.getElementById('itemDisplay').style.display = 'flex';
            document.getElementById('auctionInterface').style.display = 'none';
            auctionState.currentItem = null;
            auctionState.bidHistory = [];
            updateBidHistory();
            updateControlButtons();
        }

        // æ˜¾ç¤ºæ‹å–ç•Œé¢
        function showAuctionInterface() {
            document.getElementById('itemDisplay').style.display = 'none';
            document.getElementById('auctionInterface').style.display = 'flex';
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const item = auctionState.currentItem;
            if (!item) return;

            // æ›´æ–°ç‰©å“å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
            const itemImage = document.getElementById('itemImage');
            if (item.imageUrl) {
                itemImage.src = item.imageUrl;
                itemImage.classList.add('visible');
            } else {
                itemImage.classList.remove('visible');
            }

            document.getElementById('itemName').textContent = item.name;
            document.getElementById('itemDescription').textContent = item.description;
            document.getElementById('currentPrice').textContent = `Â¥${auctionState.currentPrice}`;
            
            updateBidHistory();
            updateStatus();
        }

        // æ›´æ–°ç‰©å“åˆ—è¡¨
        function updateItemList() {
            if (auctionState.auctionItems.length === 0) {
                document.getElementById('itemList').innerHTML = '<div class="empty-state" style="padding: 20px; font-size: 14px;">æš‚æ— ç‰©å“ï¼Œè¯·æ·»åŠ æ‹å–ç‰©å“</div>';
                return;
            }

            document.getElementById('itemList').innerHTML = auctionState.auctionItems.map((item, index) => `
                <div class="item-card ${auctionState.currentItemIndex === index ? 'active' : ''}" onclick="loadItem(${index})">
                    <div class="item-card-info">
                        ${item.imageUrl ? `<img src="${item.imageUrl}" class="item-card-image" alt="${item.name}" onerror="this.style.display='none'">` : ''}
                        <div class="item-card-details">
                            <div class="item-card-title">${item.name}</div>
                            <div class="item-card-price">èµ·æ‹ä»·: Â¥${item.startPrice}</div>
                        </div>
                    </div>
                    <div class="item-card-actions">
                        <button class="text-button edit" onclick="event.stopPropagation(); showEditItemModal(${index})">ç¼–è¾‘</button>
                        <button class="text-button delete" onclick="event.stopPropagation(); deleteItem(${index})">åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // æ›´æ–°å‡ºä»·è®°å½•
        function updateBidHistory() {
            const historyContainer = document.getElementById('bidHistory');
            
            if (auctionState.bidHistory.length === 0) {
                historyContainer.innerHTML = '<div class="empty-state">æš‚æ— å‡ºä»·è®°å½•</div>';
                return;
            }

            historyContainer.innerHTML = auctionState.bidHistory
                .slice()
                .reverse()
                .map(bid => `
                    <div class="bid-record">
                        <div>
                            <div class="bidder-name">${bid.bidder}</div>
                            <div class="bid-time">${bid.time}</div>
                        </div>
                        <div class="bid-amount">Â¥${bid.amount}</div>
                    </div>
                `).join('');
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const status = document.getElementById('auctionStatus');
            if (!auctionState.currentItem) {
                status.textContent = 'æ— ç‰©å“';
                status.style.color = '#999';
            } else if (!auctionState.isActive) {
                status.textContent = 'ç­‰å¾…å¼€å§‹';
                status.style.color = '#f39c12';
            } else {
                status.textContent = 'æ‹å–è¿›è¡Œä¸­';
                status.style.color = '#27ae60';
            }
        }

        // æ›´æ–°æ§åˆ¶æŒ‰é’®çŠ¶æ€
        function updateControlButtons() {
            const hasItems = auctionState.auctionItems.length > 0;
            const hasCurrentItem = auctionState.currentItem !== null;
            const hasBids = auctionState.bidHistory.length > 0;
            const hasParticipants = auctionState.participants.length > 0;

            document.getElementById('startButton').disabled = !hasCurrentItem || auctionState.isActive || !hasParticipants;
            document.getElementById('soldButton').disabled = !auctionState.isActive || !hasBids;
            document.getElementById('unsoldButton').disabled = !hasCurrentItem || auctionState.isActive;
            document.getElementById('nextButton').disabled = !hasItems || auctionState.isActive;
        }

        // æ·»åŠ ç«æ‹è€…
        function addParticipant() {
            const input = document.getElementById('participantName');
            const name = input.value.trim();
            
            if (!name) {
                alert('è¯·è¾“å…¥ç«æ‹è€…å§“å');
                return;
            }

            if (auctionState.participants.includes(name)) {
                alert('è¯¥ç«æ‹è€…å·²å­˜åœ¨');
                return;
            }

            auctionState.participants.push(name);
            input.value = '';
            updateParticipantList();
            updateControlButtons();
        }

        // åˆ é™¤ç«æ‹è€…
        function removeParticipant(index) {
            auctionState.participants.splice(index, 1);
            updateParticipantList();
            updateControlButtons();
        }

        // æ›´æ–°ç«æ‹è€…åˆ—è¡¨
        function updateParticipantList() {
            if (auctionState.participants.length === 0) {
                document.getElementById('participantList').innerHTML = '<div style="color: #999; font-size: 14px;">æš‚æ— ç«æ‹è€…</div>';
                return;
            }

            document.getElementById('participantList').innerHTML = auctionState.participants.map((name, index) => `
                <div class="participant">
                    ${name}
                    <span class="remove-participant" onclick="removeParticipant(${index})">Ã—</span>
                </div>
            `).join('');
        }

        // æ˜¾ç¤ºé€‰æ‹©ç«æ‹è€…æ¨¡æ€æ¡†
        function showBidderModal() {
            if (auctionState.participants.length === 0) {
                alert('è¯·å…ˆæ·»åŠ ç«æ‹è€…ï¼');
                return;
            }

            const bidderList = document.getElementById('bidderList');
            bidderList.innerHTML = auctionState.participants.map((name, index) => `
                <div class="item-card" onclick="selectBidder('${name}')" style="cursor: pointer; margin-bottom: 10px;">
                    <div class="item-card-info">
                        <div class="item-card-title" style="margin-bottom: 0;">${name}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('bidderModal').style.display = 'flex';
        }

        // å…³é—­ç«æ‹è€…é€‰æ‹©æ¨¡æ€æ¡†
        function closeBidderModal() {
            document.getElementById('bidderModal').style.display = 'none';
            auctionState.pendingBid = null;
        }

        // é€‰æ‹©ç«æ‹è€…
        function selectBidder(name) {
            auctionState.currentBidder = name;
            closeBidderModal();
            
            if (auctionState.pendingBid !== null) {
                executeBid(auctionState.pendingBid);
                auctionState.pendingBid = null;
            }
        }

        // æ‰§è¡Œå‡ºä»·
        function executeBid(amount) {
            const bid = {
                bidder: auctionState.currentBidder,
                amount: amount,
                time: new Date().toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                })
            };
            
            auctionState.currentPrice = amount;
            auctionState.bidHistory.push(bid);
            
            updateDisplay();
            
            const priceElement = document.getElementById('currentPrice');
            priceElement.style.transform = 'scale(1.2)';
            priceElement.style.color = '#f1c40f';
            
            setTimeout(() => {
                priceElement.style.transform = 'scale(1)';
                priceElement.style.color = 'white';
            }, 300);
        }

        // å¿«é€Ÿå‡ºä»·
        function quickBid(amount) {
            if (!auctionState.isActive) {
                alert('è¯·å…ˆå¼€å§‹æ‹å–ï¼');
                return;
            }

            if (!auctionState.currentBidder) {
                auctionState.pendingBid = auctionState.currentPrice + amount;
                showBidderModal();
                return;
            }
            
            const newPrice = auctionState.currentPrice + amount;
            executeBid(newPrice);
        }

        // è‡ªå®šä¹‰å‡ºä»·
        function customBid() {
            if (!auctionState.isActive) {
                alert('è¯·å…ˆå¼€å§‹æ‹å–ï¼');
                return;
            }

            const input = document.getElementById('customBid');
            const amount = parseInt(input.value);
            
            if (!amount || amount <= auctionState.currentPrice) {
                alert(`å‡ºä»·å¿…é¡»é«˜äºå½“å‰ä»·æ ¼ Â¥${auctionState.currentPrice}`);
                return;
            }

            if (!auctionState.currentBidder) {
                auctionState.pendingBid = amount;
                showBidderModal();
                return;
            }
            
            executeBid(amount);
            input.value = '';
        }

        // å¼€å§‹æ‹å–
        function startAuction() {
            if (!auctionState.currentItem) {
                alert('æ²¡æœ‰æ‹å–ç‰©å“ï¼');
                return;
            }

            if (auctionState.participants.length === 0) {
                alert('è¯·å…ˆæ·»åŠ ç«æ‹è€…ï¼');
                return;
            }
            
            auctionState.isActive = true;
            
            const initialBid = {
                bidder: 'èµ·æ‹ä»·',
                amount: auctionState.currentItem.startPrice,
                time: new Date().toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                })
            };
            auctionState.bidHistory.push(initialBid);
            
            updateDisplay();
            updateControlButtons();
        }

        // æˆäº¤
        function sold() {
            if (!auctionState.isActive || auctionState.bidHistory.length === 0) {
                alert('å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„æ‹å–ï¼');
                return;
            }

            const lastBid = auctionState.bidHistory[auctionState.bidHistory.length - 1];
            
            document.getElementById('winnerInfo').innerHTML = `
                <div style="margin-bottom: 10px;">${lastBid.bidder}</div>
                <div>ä»¥ Â¥${lastBid.amount} æˆäº¤ï¼</div>
            `;
            document.getElementById('winnerAnimation').style.display = 'flex';
            
            setTimeout(() => {
                closeWinner();
                nextItem();
            }, 3000);
        }

        // æµæ‹
        function unsold() {
            if (auctionState.isActive) {
                alert('è¯·å…ˆç»“æŸå½“å‰æ‹å–ï¼');
                return;
            }

            if (!auctionState.currentItem) return;

            if (confirm('ç¡®å®šè¦å°†æ­¤ç‰©å“æµæ‹å—ï¼Ÿ')) {
                auctionState.currentItemIndex++;
                loadNextItem();
            }
        }

        // ä¸‹ä¸€ä¸ªç‰©å“
        function nextItem() {
            auctionState.currentItemIndex++;
            loadNextItem();
        }

        // å…³é—­æˆäº¤åŠ¨ç”»
        function closeWinner() {
            document.getElementById('winnerAnimation').style.display = 'none';
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.key === ' ' && auctionState.isActive) {
                e.preventDefault();
                quickBid(10);
            } else if (e.key === 'Enter' && auctionState.isActive) {
                e.preventDefault();
                sold();
            }
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('itemModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeItemModal();
            }
        });

        document.getElementById('bidderModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBidderModal();
            }
        });

        // ç«æ‹è€…è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document.getElementById('participantName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addParticipant();
            }
        });

        // åˆå§‹åŒ–ç³»ç»Ÿ
        init();
    </script>
</body>
</html>
